define(["avalon","text!./avalon.camera.html","css!./avalon.camera.css","css!../chameleon/oniui-common.css"],function(e,t){var i=["slideX","slideY","fadeIn","crossX","crossY","stepX","stepY","rotateFadeIn"],s=e.ui.camera=function(s,r,n){var c,l,d=r.cameraOptions;d.template=d.getTemplate(t,d);var p,f=e.define(r.cameraId,function(t){e.mix(t,d),t.widgetElement=s,t.pictureWidth=e.css(s,"width"),t.pictureHeight=e.css(s,"height"),t.selections=e.range(t.pictures.length),t.selectionWrapOffset=20*-t.pictures.length/2,t.arrowVisible=t.alwaysShowArrow?!0:!1,t.pictureIndex=0,t.selectionIndex=0,t.fakehoverVisible=!1,t.nextPicture=function(){g(w(1),t.effect,1)},t.lastPicture=function(){g(w(-1),t.effect,-1)};var i=0;t.navselect=function(e,s){if(e!==t.selectionIndex){i=e,(s.type===t.eventType||"both"===t.eventType)&&("mouseenter"===s.type?setTimeout(function(){g(e,t.effect)},300):g(e,t.effect));var a=setInterval(function(){t.selectionIndex!==i?g(i,t.effect):clearInterval(a)},800)}},t.stopPlay=function(){t.hoverStop&&clearInterval(p)},t.restartPlay=function(){t.hoverStop&&h()},t.$skipArray=["widgetElement","template","selectionWrapOffset","pictures","effect","alwaysShowArrow","timeout","speed","alwaysShowSelection","hoverStop","adaptiveWidth","adaptiveHeight","eventType","arrowLeftClass","arrowRightClass","slicedCols","slicedRows"];var a;t.$init=function(i){if(!a){a=!0;var o=d.template;if(s.style.display="none",s.innerHTML=o,s.style.display="block",t.adaptiveWidth&&(t.pictureWidth=s.offsetWidth),t.adaptiveHeight){s.style.height="100%",t.pictureHeight=e.css(s,"height");for(var r=s.children,c=0,l=r.length;l>c;c++)"oni-camera"===r[c].id&&(r[c].style.height="100%")}i?i():(e.log("请尽快升到avalon1.3.7+"),e.scan(s,_vmodels),"function"==typeof d.onInit&&d.onInit.call(s,f,d,n))}},t.$remove=function(){s.innerHTML=s.textContent=""}}),u=function(){c=f.pictureWidth/f.slicedCols,l=f.pictureHeight/f.slicedRows,require(["jquery","ready!"],function(e){var t=e(s).find(".oni-camera-fakehover");t.css("display","none");for(var i=0;i<f.slicedRows;i++){for(var a=0;a<f.slicedCols;a++)t.append("<div class='fakepart'></div>"),e(".oni-camera-fakehover .fakepart:last").css({background:"url("+f.pictures[0]+")","background-position":-a*c+"px "+-i*l+"px"});t.append("<br>")}e(s).find(".oni-camera-fakehover .fakepart").css({width:c,height:l});for(var i=0;i<f.slicedRows;i++)for(var a=0;a<f.slicedCols;a++)e(s).find(".oni-camera-fakehover .fakepart").eq(i*f.slicedCols+a).css({width:c,height:l});h()})},h=function(){p=setInterval(function(){g(w(1),f.effect,1)},f.timeout)},v=!1,g=function(e,t,o){if(o=o||1,!v){v=!0,f.selectionIndex=e;for(var r=$(s).find(".oni-camera-fakehover .fakepart"),n=0,t="random"===t?i[Math.floor(Math.random()*i.length)]:t,d=0;d<f.slicedRows;d++)for(var p=0;p<f.slicedCols;p++){var u=r.eq(d*f.slicedCols+p),h=f.speed,g=0,w=p%2===0?1:-1;u.css({background:"url("+f.pictures[e]+")","background-position":-p*c+"px "+-d*l+"px","background-size":f.pictureWidth+"px "+f.pictureHeight+"px",top:d*l+"px",left:p*c+"px"});var m=parseFloat(u.css("top")),y=parseFloat(u.css("left"));switch(t){case"slideX":u.css({left:y+f.pictureWidth*o});break;case"slideY":u.css({top:m+f.pictureHeight*o});break;case"fadeIn":u.css({opacity:0});break;case"crossX":w=d%2===0?1:-1,u.css({left:y+w*f.pictureWidth*o});break;case"crossY":u.css({top:m+w*f.pictureHeight*o});break;case"stepX":u.css({left:y+(f.pictureWidth+f.pictureWidth/f.slicedRows*d)*o}),h+=d*(f.speed/f.slicedRows);break;case"stepY":u.css({top:m+(f.pictureHeight+f.pictureHeight/f.slicedCols*p)*o}),h+=p*(f.speed/f.slicedCols);break;case"rotateFadeIn":u.css({opacity:0});var k=a(f.slicedCols,f.slicedRows);g=k[d][p]*(f.speed/(f.slicedCols*f.slicedRows))}f.fakehoverVisible=!0,u.delay(g).animate({top:m+"px",left:y+"px",opacity:1},h,function(){n+=1,n===f.slicedRows*f.slicedCols&&(f.fakehoverVisible=!1,f.pictureIndex=e,v=!1)})}}},w=function(e){var t=f.pictureIndex;return t=1===e?t+1:t-1,t===f.pictures.length?t=0:-1===t&&(t=f.pictures.length-1),t};return 0===e.css(s,"height")?o(f.pictures[0],function(){f.pictureHeight=this.height,f.pictureWidth=this.width,u()}):u(),f},a=function(e,t){for(var i=[],s=0;t>s;s++)i[s]=new Array(e);for(var a=0,o=0,r=e-1,n=t-1,c=0,l=0,s=0;e*t>s;s++)i[c][l]=s+1,c==o&&r>l?l++:n>c&&l==r?c++:c==n&&l>a?l--:c>o&&l==a&&c--,c-1==o&&l==a&&(o++,a++,r--,n--);return i},o=function(){var e=[],t=null,i=function(){for(var t=0;t<e.length;t++)e[t].end?e.splice(t--,1):e[t]();!e.length&&s()},s=function(){clearInterval(t),t=null};return function(s,a,o,r){var n,c,l,d,p,f=new Image;return f.src=s,f.complete?(a.call(f),void(o&&o.call(f))):(c=f.width,l=f.height,f.onerror=function(){r&&r.call(f),n.end=!0,f=f.onload=f.onerror=null},n=function(){d=f.width,p=f.height,(d!==c||p!==l||d*p>1024)&&(a.call(f),n.end=!0)},n(),f.onload=function(){!n.end&&n(),o&&o.call(f),f=f.onload=f.onerror=null},void(n.end||(e.push(n),null===t&&(t=setInterval(i,40)))))}}();s.vertion=1.1,s.defaults={pictures:[],effect:"random",timeout:2500,speed:600,alwaysShowArrow:!0,alwaysShowSelection:!0,hoverStop:!0,adaptiveWidth:!1,adaptiveHeight:!1,eventType:"click",arrowLeftClass:"",arrowRightClass:"",slicedCols:5,slicedRows:4,onInit:e.noop,getTemplate:function(e){return e},$author:"heiwu805@hotmail.com"}});